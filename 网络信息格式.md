# 网络信息格式

定义客户端和服务端之间交互信息模式

基本背景：server使用TCP与客户端连接，登陆后每个连接都对应一个Account（服务器记忆相关数据，客户端也缓存账户数据）

基本结构：
客户端发送：
{
    "type":...,
    data:{}
}

服务端返回：
{
    Statu:"ok",
    data:{}
}
或
{
    Statu:"err",
    data:{
        "err_info":...
    }
}
错误返回在出错时返回，下面略写。

基本错误：字段缺失、字段解析错误、服务器内部错误

## 用户操作

### 注册

发送：data对象：用户账户基本数据（不含AID）
返回：data对象：含AID不包含passwordHex的用户账户数据
可能的错误类型：PID或phone已存在

### 登录

PID登录或者手机号(phone)登录。

发送：data对象：账户识别数据（PID/Phone）+ passwordHex
返回：data对象：不包含passwordHex的用户账户数据
可能的错误类型：PID或phone不存在、password错误

### 退出登录

发送：data对象：AID
返回：data对象：无
可能的错误类型：未登录、AID与后端缓存不匹配

### 注销账户

发送：data对象：AID
返回：data对象：无
可能的错误类型：未登录、AID与后端缓存不匹配

### 账户信息修改

发送：data对象：修改信息后的Account对象
返回：data对象：更新后的Account对象
可能的错误类型：未登录、AID与后端缓存不匹配、不可变字段不匹配

### 科室列表查询

发送：data对象：无
返回：data对象：科室列表
可能的错误类型：未登录（通过服务器缓存判断）

### 医生查询

通过部门、姓名或DID查询医生

发送：data对象：医生识别数据（Department/Name/DID）
返回：data对象：医生列表，其中每个元素都包含基本数据（DID,Name,Department,Describe）
可能的错误类型：未登录（通过服务器缓存判断）、科室不存在、DID不存在

### 医生的排班查询

通过医生DID查询相关排班

发送：data对象：DID
返回：data对象：排班对象列表，其中每个元素都是Schedule对象
可能的错误类型：未登录（通过服务器缓存判断）、DID不存在

### 时间的排班查询

通过时间和部门查询相关排班

发送：data对象：目标时间,部门
返回：data对象：排班对象列表，其中每个元素都是Schedule对象
可能的错误类型：未登录（通过服务器缓存判断）、部门不存在

### 预约挂号

发送：data对象：DID,SID
返回：data对象：Appointment对象
可能的错误类型：未登录（通过服务器缓存判断）、DID不存在、SID不存在、DID与SID不对应、剩余容量为0

### 取消预约

发送：data对象：APID
返回：data对象：改变后的Appointment对象
可能的错误类型：未登录（通过服务器缓存判断）、APID不存在、AID与APID不对应、超过允许时间

### 查询自己的所有预约

发送：data对象：无
返回：data对象：Appointment对象列表
可能的错误类型：未登录（通过服务器缓存判断）

## 医生操作

### 登录

发送：data对象：DID,passwordHex
返回：data对象：DoctorAccount对象（不包含passwordHex）
可能的错误类型：DID不存在、password错误

### 退出登录

发送：data对象：DID
返回：data对象：无
可能的错误类型：未登录、AID与后端缓存不匹配

### 获取自己的排班计划

发送：data对象：无
返回：data对象：排班对象列表，其中每个元素都是Schedule对象
可能的错误类型：未登录（通过服务器缓存判断）

### 获取预约自己的信息

发送：data对象：无
返回：data对象：Appointment对象列表
可能的错误类型：未登录（通过服务器缓存判断）

### 叫号

发送：data对象：当前SID,当前serialNumber
返回：data对象：当前医生（DID）当前排班（SID对应的Schedule）的对应下一个serialNumber的Appointment对象
可能的错误类型：未登录（通过服务器缓存判断）、SID不存在、当前时间不符合SID对应排班

### 添加排班（Admin）

发送：data对象：Schedule对象列表
返回：data对象：无
可能的错误类型：未登录（通过服务器缓存判断）、不是Admin、某个DID对应的多个排班的时间重叠（已有和新加都考虑）

### 修改排班（Admin）

发送：data对象：修改后的Schedule对象
返回：data对象：无
可能的错误类型：未登录（通过服务器缓存判断）、SID不存在、不是Admin、某个DID对应的多个排班的时间重叠、不可变字段不匹配

### 获取预约记录（Admin）

发送：data对象：无
返回：data对象：Appointment对象列表（包含数据库中所有Appointment的数据）
可能的错误类型：未登录（通过服务器缓存判断）、不是Admin

### 获取统计报告（Admin）

发送：data对象：无
返回：data对象：Appointment对象列表，Schedule对象列表，DoctorAccount对象列表（包含数据库中所有相关数据）
可能的错误类型：未登录（通过服务器缓存判断）、不是Admin
