# 环境

当前环境：
    1.wsl-archlinux
    2.Apache Maven 3.9.12
    3.openjdk 25.0.1
    4.mariadb 12.1.2-1
目标环境：
    1.linux any
    2.Apache Maven
    3.openjdk 17+
    4.mariadb 10+

数据库：HABMSDB
使用账户：rjava
密码：rjava
java 根包名：HABMS

# 目标

设计一个java包HABMS.db：对上层提供HABMSDB类抽象数据库操作。

# 表设计

表：
CREATE TABLE Account (
    AID CHAR(10) NOT NULL PRIMARY KEY,
    Name VARCHAR(20) NOT NULL,
    Password BINARY(64) NOT NULL,
    PID CHAR(18) NOT NULL,
    Phone CHAR(11) NOT NULL,
    Sex ENUM('M','F') NOT NULL
)engine=InnoDB default charset=utf8;

CREATE TABLE Doctor (
    DID CHAR(8) NOT NULL PRIMARY KEY,
    Name VARCHAR(20) NOT NULL,
    Password BINARY(64) NOT NULL,
    Admin BOOLEAN NOT NULL,
    Department VARCHAR(30) NOT NULL,
    Description VARCHAR(200)
)engine=InnoDB default charset=utf8;
初始表内应有记录：('00000000','Admin','c1c224b03cd9bc7b6a86d77f5dace40191766c485cd55dc48caf9ac873335d6f',True,'管理',)

CREATE TABLE Appointment (
    APID CHAR(12) NOT NULL PRIMARY KEY,
    AID CHAR(10) NOT NULL,
    DID CHAR(8) NOT NULL,
    SID INT NOT NULL,
    Statu ENUM('Ok','Abandon','Done') NOT NULL
)engine=InnoDB default charset=utf8;

CREATE TABLE Schedule (
    SID INT NOT NULL PRIMARY KEY,
    DID CHAR(8) NOT NULL,
    STime DATETIME NOT NULL,
    ETime DATETIME NOT NULL,
    Capacity INT NOT NULL,
    Res INT NOT NULL
)engine=InnoDB default charset=utf8;

附加任务：写一个sql脚本初始化以上表。

上述表结构在java中都应该有对应的数据类，即Account、DoctorAccount、Appointment和Schedule。
且其中的AID、DID、APID、SID在对象通过create工厂方法创建时分配（各自的ID不可重复）。
其中Appointment数据对象应该增加STime和ETime属性，应该在合适时机自动通过SID查询获取。
其中Schedule通过create工厂方法创建时，Res初始化为Capacity的值。

# Java HABMS.db.HABMSDB类设计

下列方法都应该是对象的public方法，参数表和错误抛出自行推断。

## 构建方法
连接到数据库

// insert

## void InsertAccount
向Account表插入一个记录

## void InsertDoctorAccount
向Doctor表插入一个记录

## void InsertAppointment
向Appointment表插入一个记录

## void InsertSchedule
向Schedule表插入一个记录

## void InsertSchedules
向Schedule表插入多个记录

// del

## void DelAccount
Account表删除一个指定记录

## void DelDoctorAccount
Doctor表删除一个指定记录

## void DelAppointment
Appointment表删除一个指定记录

## void DelSchedule
Schedule表删除一个指定记录

// find 

## Account FindAccount
在Account表寻找一个记录（通过AID、PID或Phone）

## DoctorAccount FindDoctorAccount
在Doctor表寻找一个记录（通过DID或Name）

## DoctorAccount[] FindDoctorAccounts
在Doctor表寻找记录（通过Department）

## Appointment FindAppointment
在Appointment表寻找一个记录（通过APID）

## Appointment[] FindAppointmentBelongAccount
在Appointment表寻找记录（通过AID）

## Appointment[] FindAppointmentBelongDoctorAccount
在Appointment表寻找记录（通过DID）

## Appointment[] FindAppointmentBelongSchedule
在Appointment表寻找记录（通过SID）

## Appointment[] FindAppointmentByStatu
在Appointment表寻找记录（通过Statu）

## Schedule FindSchedule
在Schedule表寻找一个记录（通过SID）

## Schedule[] FindScheduleBelongDoctorAccount
在Schedule表寻找记录（通过DID）

## Schedule[] FindScheduleByTime
在Schedule表寻找记录（通过Time，当STime<=Time<=ETime时判断符合）

// change

## void ChangeAccountInfo
输入一个Account对象，修改AID对应的记录的数据，只检查更新Name、Password和Phone字段

## void ChangeDoctorAccountInfo
修改对应DID的记录数据，输入一个DoctorAccount对象，DID字段不能更新

## void ChangeAppointmentStatu
修改对应APID的记录的Statu字段

## void ChangeScheduleCapacity
修改对应SID的记录的Capacity字段。
同时，原子性地更新Res字段：Capacity字段加多少，Res加多少（或通过数据库操作行加锁）

## Appointment TryAppointment
输入AID、SID，通过带条件的UPDATE SQL语句将SID对应的Res值减一
要求：通过数据库操作保证原子性地read-check-do：索引SID对应的Appointment记录，检查Res>0，减1
成功则通过create工厂方法创建Appointment对象并插入Appointment表，返回Appointment对象
失败则返回NULL

