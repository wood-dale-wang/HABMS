<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane prefHeight="600.0" prefWidth="900.0" styleClass="border-pane app-root" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="HABMS.client.controller.AdminMainController">
   <top>
      <HBox alignment="CENTER_LEFT" spacing="12.0" styleClass="header-bar" BorderPane.alignment="CENTER">
         <padding>
            <Insets bottom="12.0" left="20.0" right="20.0" top="12.0" />
         </padding>
         <children>
            <Label text="管理端" styleClass="header-title">
               <font>
                  <Font size="22.0" />
               </font>
            </Label>
            <Label text="导入医生账户与排班表" styleClass="header-subtitle" />
         </children>
      </HBox>
   </top>
   <center>
      <ScrollPane fitToWidth="true" BorderPane.alignment="CENTER">
         <content>
            <VBox spacing="16.0">
               <padding>
                  <Insets bottom="20.0" left="20.0" right="20.0" top="10.0" />
               </padding>
               <children>
                  <TitledPane animated="false" expanded="true" text="导入医生账户">
                     <content>
                        <VBox spacing="10.0">
                           <padding>
                              <Insets top="10.0" right="10.0" bottom="10.0" left="10.0" />
                           </padding>
                           <children>
                              <Label text="选择 CSV/TXT，密码列需为明文，前端会自动 SHA-256。" wrapText="true" />
                              <HBox spacing="10.0">
                                 <children>
                                    <Button mnemonicParsing="false" onAction="#handleImportDoctors" styleClass="primary-button" text="选择并导入医生账户" />
                                    <Button mnemonicParsing="false" onAction="#handleManualAddDoctor" styleClass="secondary-button" text="手动添加医生" />
                                 </children>
                              </HBox>
                              <Label fx:id="doctorFileLabel" text="未选择文件" styleClass="muted" />
                              <Label fx:id="doctorImportResult" text="" />
                              <Label text="示例表格" styleClass="muted" />
                              <TextArea editable="false" prefHeight="120.0" style="-fx-font-family: 'Consolas'; -fx-font-size: 12;" text="did,name,password,department,admin,description&#10;10000001,DrAlice,Pa55word,Cardiology,false,夜班经验丰富&#10;10000002,DrBob,S3cur3!,Surgery,true,教研管理员" wrapText="true" />
                           </children>
                        </VBox>
                     </content>
                  </TitledPane>
                  <TitledPane animated="false" expanded="true" text="导入排班表">
                     <content>
                        <VBox spacing="10.0">
                           <padding>
                              <Insets top="10.0" right="10.0" bottom="10.0" left="10.0" />
                           </padding>
                           <children>
                              <Label text="选择 CSV/TXT，时间字段使用 ISO-8601（例 2026-01-01T09:00:00）。" wrapText="true" />
                              <HBox spacing="10.0">
                                 <children>
                                    <Button mnemonicParsing="false" onAction="#handleImportSchedules" styleClass="primary-button" text="选择并导入排班表" />
                                    <Button mnemonicParsing="false" onAction="#handleManualAddSchedule" styleClass="secondary-button" text="手动添加排班" />
                                 </children>
                              </HBox>
                              <Label fx:id="scheduleFileLabel" text="未选择文件" styleClass="muted" />
                              <Label fx:id="scheduleImportResult" text="" />
                              <Label text="示例表格" styleClass="muted" />
                              <TextArea editable="false" prefHeight="120.0" style="-fx-font-family: 'Consolas'; -fx-font-size: 12;" text="did,name,department,startTime,endTime,capacity&#10;10000001,DrAlice,Cardiology,2026-01-01T09:00:00,2026-01-01T12:00:00,20&#10;10000002,DrBob,Surgery,2026-01-02T14:00:00,2026-01-02T18:00:00,16" wrapText="true" />
                           </children>
                        </VBox>
                     </content>
                  </TitledPane>
                  <TitledPane animated="false" expanded="true" text="预约数据与报表">
                     <content>
                        <VBox spacing="10.0">
                           <padding>
                              <Insets top="10.0" right="10.0" bottom="10.0" left="10.0" />
                           </padding>
                           <children>
                              <HBox spacing="10.0" alignment="CENTER_LEFT">
                                 <children>
                                    <Button mnemonicParsing="false" onAction="#handleRefreshAppointments" styleClass="secondary-button" text="刷新预约数据" />
                                    <Label fx:id="appointmentStatusLabel" text="未加载" styleClass="muted" />
                                 </children>
                              </HBox>
                              <HBox spacing="10.0">
                                 <children>
                                    <Button mnemonicParsing="false" onAction="#handleExportAppointments" styleClass="primary-button" text="导出预约记录 (Excel)" />
                                    <Button mnemonicParsing="false" onAction="#handleGenerateReport" styleClass="secondary-button" text="生成月度报告 (PDF)" />
                                 </children>
                              </HBox>
                              <Label text="使用 admin_all_appointments + admin_report 聚合" styleClass="muted" />
                           </children>
                        </VBox>
                     </content>
                  </TitledPane>
                  <TitledPane animated="false" expanded="true" text="查看全部医生">
                     <content>
                        <VBox spacing="10.0">
                           <padding>
                              <Insets top="10.0" right="10.0" bottom="10.0" left="10.0" />
                           </padding>
                           <children>
                              <HBox alignment="CENTER_LEFT" spacing="10.0">
                                 <children>
                                    <Button fx:id="refreshDoctorBtn" mnemonicParsing="false" onAction="#handleRefreshDoctors" styleClass="secondary-button" text="刷新医生列表" />
                                    <Button mnemonicParsing="false" onAction="#handleEditDoctor" styleClass="secondary-button" text="修改选中医生" />
                                    <Button mnemonicParsing="false" onAction="#handleDeleteDoctor" styleClass="danger-button" text="删除选中医生" style="-fx-background-color: #e74c3c; -fx-text-fill: white;" />
                                    <Label text="按科室汇总 doctor_query" styleClass="muted" />
                                 </children>
                              </HBox>
                              <TableView fx:id="doctorTable" prefHeight="220.0">
                                 <columns>
                                    <TableColumn fx:id="colDid" prefWidth="90.0" text="DID" />
                                    <TableColumn fx:id="colName" prefWidth="120.0" text="姓名" />
                                    <TableColumn fx:id="colDept" prefWidth="120.0" text="科室" />
                                    <TableColumn fx:id="colAdmin" prefWidth="80.0" text="管理员" />
                                    <TableColumn fx:id="colDesc" prefWidth="200.0" text="描述" />
                                 </columns>
                              </TableView>
                              <Label fx:id="doctorListResult" styleClass="error-label" />
                           </children>
                        </VBox>
                     </content>
                  </TitledPane>
                  <TitledPane animated="false" expanded="true" text="查看全部排班">
                     <content>
                        <VBox spacing="10.0">
                           <padding>
                              <Insets top="10.0" right="10.0" bottom="10.0" left="10.0" />
                           </padding>
                           <children>
                              <HBox alignment="CENTER_LEFT" spacing="10.0">
                                 <children>
                                    <Button fx:id="refreshScheduleBtn" mnemonicParsing="false" onAction="#handleRefreshSchedules" styleClass="secondary-button" text="刷新排班列表" />
                                    <Button mnemonicParsing="false" onAction="#handleEditSchedule" styleClass="secondary-button" text="修改选中排班" />
                                    <Button mnemonicParsing="false" onAction="#handleDeleteSchedule" styleClass="danger-button" text="删除选中排班" style="-fx-background-color: #e74c3c; -fx-text-fill: white;" />
                                 </children>
                              </HBox>
                              <TableView fx:id="scheduleTable" prefHeight="220.0">
                                 <columns>
                                    <TableColumn fx:id="colSid" prefWidth="60.0" text="SID" />
                                    <TableColumn fx:id="colSDid" prefWidth="90.0" text="DID" />
                                    <TableColumn fx:id="colSStart" prefWidth="150.0" text="开始时间" />
                                    <TableColumn fx:id="colSEnd" prefWidth="150.0" text="结束时间" />
                                    <TableColumn fx:id="colSCap" prefWidth="60.0" text="容量" />
                                    <TableColumn fx:id="colSRes" prefWidth="60.0" text="已约" />
                                 </columns>
                              </TableView>
                              <Label fx:id="scheduleListResult" styleClass="error-label" />
                           </children>
                        </VBox>
                     </content>
                  </TitledPane>
                  <HBox alignment="CENTER_RIGHT" spacing="10.0">
                     <children>
                        <Button mnemonicParsing="false" onAction="#handleLogout" styleClass="secondary-button" text="退出登录" />
                     </children>
                  </HBox>
               </children>
            </VBox>
         </content>
      </ScrollPane>
   </center>
</BorderPane>
